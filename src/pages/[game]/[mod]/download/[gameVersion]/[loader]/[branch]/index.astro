---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import curseForgeLogo from '../../../../_curseforge.svg';
import modrinthLogo from '../../../../_modrinth.svg';
import Layout from '../../../../../../../layouts/Layout.astro';
import MavenTable from '../../../../../../../components/MavenTable.vue';

export async function getStaticPaths() {
    const branches = ['release', 'snapshot'];
    const modEntries = await getCollection('mods');
    return modEntries.flatMap((entry) =>
        entry.data.gameVersions.flatMap((gameVersion: string) =>
            entry.data.loaders.flatMap((loader: string) =>
                branches.flatMap((branch) => {
                    const parts = entry.slug.split('/');
                    return {
                        params: { game: parts[0], mod: parts[1], gameVersion, branch, loader: loader.toLowerCase() },
                        props: { entry, gameVersion, loader, branch },
                    };
                })
            )
        )
    );
}

const { entry, gameVersion, loader, branch } = Astro.props;

const title = 'Download ' + entry.data.title + ' for Minecraft ' + gameVersion + ' (' + loader + ')';
const curseForgeUrl = entry.data.curseForgeSlug ? `https://www.curseforge.com/minecraft/mc-mods/${entry.data.curseForgeSlug}` : null;
const modrinthUrl = entry.data.modrinthSlug ? `https://modrinth.com/mod/${entry.data.modrinthSlug}` : null;
---

<Layout title={title}>
    <h1 class="text-4xl text-center mb-4">{title}</h1>

    <div class="text-center"></div>

    <MavenTable client:load modData={entry.data} branch={branch} loader={loader} gameVersion={gameVersion} />

    <div class="divider"></div>

    <p class="text-center text-lg opacity-80 mb-4">Looking for older versions?</p>

    <div class="flex justify-center items-center gap-4">
        {
            curseForgeUrl && (
                <a href={curseForgeUrl} class="btn btn-curseforge">
                    <Image src={curseForgeLogo} alt="" class="w-6" />
                    Downloads on CurseForge
                </a>
            )
        }
        {
            modrinthUrl && (
                <a href={modrinthUrl} class="btn btn-modrinth">
                    <Image src={modrinthLogo} alt="" class="w-6" />
                    Downloads on Modrinth
                </a>
            )
        }
    </div>

    <div class="divider"></div>

    <!--<div class="mb-4 flex justify-center">
        <a href="/sponsor"><img src="https://mods.twelveiterations.com/img/sponsor.png" alt="Support the Development for only $2 a month." /></a>
    </div>-->
</Layout>
